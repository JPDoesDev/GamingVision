<Window x:Class="GamingVision.Overlay.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="GamingVision Overlay"
        Width="600"
        Height="840"
        MinWidth="500"
        MinHeight="660"
        WindowStartupLocation="CenterScreen">
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Game Selection -->
        <GroupBox Header="Select Game" Grid.Row="0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <ComboBox x:Name="GameComboBox"
                          Grid.Column="0"
                          ItemsSource="{Binding GameProfiles}"
                          SelectedItem="{Binding SelectedGameProfile}">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding DisplayName}"/>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>
                <Button Grid.Column="1"
                        Content="Game Settings"
                        Command="{Binding OpenGameSettingsCommand}"
                        Margin="10,0,0,0"
                        MinWidth="120"/>
            </Grid>
        </GroupBox>

        <!-- Overlay Settings -->
        <GroupBox Header="Overlay Settings" Grid.Row="1">
            <StackPanel>
                <Grid Margin="0,0,0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="150"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="60"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="Confidence Threshold:" VerticalAlignment="Center"/>
                    <Slider x:Name="ConfidenceSlider"
                            Grid.Column="1"
                            Minimum="0.1"
                            Maximum="1.0"
                            Value="{Binding ConfidenceThreshold}"
                            TickFrequency="0.05"
                            IsSnapToTickEnabled="True"
                            VerticalAlignment="Center"
                            Margin="10,0"/>
                    <TextBlock Grid.Column="2"
                               Text="{Binding ConfidenceThreshold, StringFormat={}{0:F2}}"
                               VerticalAlignment="Center"
                               HorizontalAlignment="Right"/>
                </Grid>

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="150"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="Toggle Hotkey:" VerticalAlignment="Center"/>
                    <TextBox Grid.Column="1"
                             Text="{Binding ToggleHotkey, UpdateSourceTrigger=PropertyChanged}"
                             MaxLength="20"/>
                </Grid>
            </StackPanel>
        </GroupBox>

        <!-- Overlay Groups -->
        <GroupBox Header="Overlay Groups" Grid.Row="2">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <ListBox x:Name="GroupsListBox"
                         ItemsSource="{Binding OverlayGroups}"
                         SelectedItem="{Binding SelectedGroup}"
                         Grid.Row="0"
                         Margin="0,0,0,10">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Grid Margin="5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="20"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <!-- Color indicator -->
                                <Rectangle Width="16" Height="16"
                                           Fill="{Binding Color, Converter={StaticResource ColorStringToBrushConverter}}"
                                           Stroke="White"
                                           StrokeThickness="1"/>
                                <!-- Group name -->
                                <TextBlock Grid.Column="1"
                                           Text="{Binding Name}"
                                           Margin="10,0,0,0"
                                           VerticalAlignment="Center"/>
                                <!-- Label count -->
                                <TextBlock Grid.Column="2"
                                           Text="{Binding Labels.Count, StringFormat=({0} labels)}"
                                           Foreground="{StaticResource SecondaryTextBrush}"
                                           VerticalAlignment="Center"/>
                            </Grid>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

                <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Center">
                    <Button Content="Add" Command="{Binding AddGroupCommand}" MinWidth="80"/>
                    <Button Content="Edit" Command="{Binding EditGroupCommand}" MinWidth="80"/>
                    <Button Content="Remove" Command="{Binding RemoveGroupCommand}" MinWidth="80"/>
                    <Button Content="Move Up" Command="{Binding MoveGroupUpCommand}" MinWidth="80"/>
                    <Button Content="Move Down" Command="{Binding MoveGroupDownCommand}" MinWidth="80"/>
                </StackPanel>
            </Grid>
        </GroupBox>

        <!-- Note -->
        <Border Grid.Row="3"
                Background="{StaticResource SurfaceBrush}"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="1"
                CornerRadius="4"
                Padding="10"
                Margin="0,0,0,15">
            <TextBlock Text="Note: For best compatibility, use borderless windowed mode in your game."
                       Foreground="{StaticResource SecondaryTextBrush}"
                       TextWrapping="Wrap"/>
        </Border>

        <!-- Action Buttons -->
        <Grid Grid.Row="4">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Status Indicator -->
            <Border Grid.Column="0"
                    Background="{StaticResource SurfaceBrush}"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="1"
                    CornerRadius="4"
                    Padding="10,5"
                    VerticalAlignment="Center">
                <StackPanel Orientation="Horizontal">
                    <Ellipse Width="12" Height="12" VerticalAlignment="Center">
                        <Ellipse.Style>
                            <Style TargetType="Ellipse">
                                <Setter Property="Fill" Value="#666666"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsOverlayRunning}" Value="True">
                                        <Setter Property="Fill" Value="#00FF00"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Ellipse.Style>
                    </Ellipse>
                    <TextBlock VerticalAlignment="Center" Margin="8,0,0,0">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Text" Value="Inactive"/>
                                <Setter Property="Foreground" Value="{StaticResource SecondaryTextBrush}"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsOverlayRunning}" Value="True">
                                        <Setter Property="Text" Value="Active - Detecting"/>
                                        <Setter Property="Foreground" Value="#00FF00"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                </StackPanel>
            </Border>

            <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Command="{Binding StartOverlayCommand}"
                        Content="{Binding StartButtonText}"
                        MinWidth="120">
                    <Button.Style>
                        <Style TargetType="Button" BasedOn="{StaticResource {x:Type Button}}">
                            <Setter Property="Background" Value="{StaticResource AccentBrush}"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsOverlayRunning}" Value="True">
                                    <Setter Property="Background" Value="#CC3333"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>
                <Button Content="Save" Command="{Binding SaveCommand}" MinWidth="100"/>
                <Button Content="Close" Command="{Binding CloseCommand}" MinWidth="100"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window>
